<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Be Heard - Vocabulary Mastery</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #001184;
            --secondary: #eef2ff;
            --accent: #ff70a6;
            --success: #28a745;
            --error: #dc3545;
            --bg: #f8f9fe;
            --text: #2d3436;
        }

        body {
            font-family: 'Quicksand', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 0;
            line-height: 1.6;
            overscroll-behavior: none; 
        }

        .container { max-width: 1100px; margin: 0 auto; padding: 20px; }

        header {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, var(--primary), #051aab);
            color: white;
            border-radius: 0 0 40px 40px;
            margin-bottom: 30px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.05);
            margin-bottom: 30px;
        }

        #input-area {
            width: 100%;
            min-height: 120px;
            border: 2px dashed #cbd5e0;
            border-radius: 15px;
            padding: 15px;
            font-size: 16px;
            outline: none;
            margin-bottom: 20px;
            box-sizing: border-box;
            background: #fff;
        }

        .btn-group { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; }

        button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.2s ease;
        }
        
        .btn-alt { background-color: var(--accent); }

        /* --- Layout --- */
        .main-layout {
            display: grid;
            grid-template-columns: 1fr 320px; /* C·ªôt tr√°i: C√¢u h·ªèi + N√∫t n·ªôp, C·ªôt ph·∫£i: Kho t·ª´ */
            gap: 25px;
            margin-bottom: 50px;
        }

        .sentence-card {
            background: white;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 18px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.03);
            border: 1px solid #f0f0f0;
        }

        .q-number {
            background: var(--primary);
            color: white;
            font-weight: 700;
            min-width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-size: 0.85rem;
            margin-top: 3px;
        }

        .drop-zone {
            display: inline-block;
            min-width: 100px;
            border-bottom: 2px solid var(--primary);
            margin: 0 5px;
            text-align: center;
            font-weight: 700;
            color: var(--primary);
            background: #f0f3ff;
            border-radius: 6px;
            padding: 4px 10px;
            min-height: 28px;
            vertical-align: bottom;
            transition: all 0.2s;
        }
        
        /* --- Word Bank Styles --- */
        .word-bank-container {
            position: sticky;
            top: 20px;
            height: fit-content;
            z-index: 1000;
        }

        .word-bank {
            background: white;
            padding: 15px;
            border-radius: 20px;
            border: 2px solid var(--secondary);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .word-bank h3 { 
            margin: 0 0 10px 0; 
            font-size: 1rem; 
            text-align: center; 
            color: var(--primary);
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }

        .draggable-word {
            display: inline-block;
            background: #fff;
            padding: 8px 14px;
            margin: 4px;
            border-radius: 12px;
            cursor: grab;
            border: 1px solid #d1d5db;
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--primary);
            touch-action: none; 
            user-select: none;
            -webkit-user-select: none;
        }

        .draggable-word.used { 
            opacity: 0.3; 
            pointer-events: none; 
            background: #f1f5f9; 
            border-color: transparent;
        }

        .dragging-clone {
            position: fixed;
            pointer-events: none;
            z-index: 9999;
            background: var(--accent);
            color: white;
            padding: 8px 14px;
            border-radius: 12px;
            font-weight: 700;
            opacity: 0.9;
            transform: scale(1.1);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            border: 2px solid white;
        }

        /* --- Mobile Responsive --- */
        @media (max-width: 900px) {
            .main-layout { 
                grid-template-columns: 1fr; /* Ch·ªâ c√≤n 1 c·ªôt */
                margin-bottom: 0;
            }

            /* Container ch·ª©a n√∫t n·ªôp b√†i */
            #submit-container {
                margin-top: 20px;
                margin-bottom: 250px; /* QUAN TR·ªåNG: T·∫°o kho·∫£ng tr·ªëng l·ªõn b√™n d∆∞·ªõi n√∫t n·ªôp ƒë·ªÉ ƒë·∫©y n√≥ l√™n tr√™n kho t·ª´ v·ª±ng */
                text-align: center;
            }

            .word-bank-container {
                position: fixed;
                top: auto;
                bottom: 0;
                left: 0;
                width: 100%;
                background: white;
                box-shadow: 0 -5px 25px rgba(0,0,0,0.15);
                border-radius: 20px 20px 0 0;
                padding: 15px 0 25px 0;
                z-index: 2000;
            }

            .word-bank {
                border: none;
                box-shadow: none;
                max-height: 180px;
                overflow-y: auto;
                padding: 0 15px;
            }
        }

        /* ·∫®n hi·ªán c√°c view */
        .hidden { display: none; }
        .viet-sub { font-style: italic; color: #666; font-size: 0.9rem; display: block; margin-top: 5px;}
        .correct-ans { color: var(--success); font-weight: bold; }
        .wrong-ans { color: var(--error); text-decoration: line-through; }
        .score-banner { font-size: 1.5rem; color: var(--primary); font-weight: bold; text-align: center; margin-bottom: 20px;}
    </style>
</head>
<body>

<header>
    <h1>H·ªçc c√πng Be Heard</h1>
    <p>T·∫£i l√™n danh s√°ch c√¢u c√≥ in ƒë·∫≠m ho·∫∑c g·∫°ch ch√¢n t·ª´ v·ª±ng c·∫ßn h·ªçc</p>
</header>

<div class="container">
    <div id="setup-card" class="card">
        <div id="input-area" contenteditable="true" placeholder="... ho·∫∑c ƒë·ªÉ tr·ªëng ƒë·ªÉ d√πng d·ªØ li·ªáu m·∫´u"></div>
        <div class="btn-group">
            <input type="file" id="file-upload" accept=".docx" style="display:none">
            <button onclick="document.getElementById('file-upload').click()">üìÅ T·∫£i file Word</button>
            <button class="btn-alt" onclick="startExercise()">üéØ B·∫Øt ƒë·∫ßu</button>
        </div>
    </div>

    <div id="exercise-view" class="hidden">
        <div class="main-layout">
            <div class="question-column">
                <div id="questions-list"></div>
                
                <div id="submit-container" style="text-align: center; margin-top: 30px;">
                    <button id="submit-btn" style="padding: 15px 80px; font-size: 1.2rem; border-radius: 100px; box-shadow: 0 10px 20px rgba(0,17,132,0.2);">N·ªôp B√†i</button>
                </div>
            </div>

            <div class="word-bank-container">
                <div class="word-bank">
                    <h3>KHO T·ª™ V·ª∞NG (K√©o th·∫£)</h3>
                    <div id="bank-content"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="result-view" class="card hidden">
        <div id="score-text" class="score-banner"></div>
        <div id="detailed-results"></div>
        <div style="text-align: center; margin-top: 30px;">
            <button onclick="location.reload()" style="background: var(--accent)">L√†m b√†i m·ªõi</button>
        </div>
    </div>
</div>

<script>
    // ============================================================
    // V√ôNG D·ªÆ LI·ªÜU C·ª¶A B·∫†N - D√ÅN V√ÄO ƒê√ÇY
    // ============================================================
    const FALLBACK_DATA = [
       { text: "The team had to **collaborate** closely to meet the project deadline.", trans: "Nh√≥m ƒë√£ ph·∫£i h·ª£p t√°c ch·∫∑t ch·∫Ω ƒë·ªÉ k·ªãp th·ªùi h·∫°n d·ª± √°n." },
        { text: "Her **meticulous** planning ensured the event was a huge success.", trans: "S·ª± l·∫≠p k·∫ø ho·∫°ch t·ªâ m·ªâ c·ªßa c√¥ ·∫•y ƒë√£ ƒë·∫£m b·∫£o s·ª± ki·ªán th√†nh c√¥ng r·ª±c r·ª°." },
        { text: "Scientists are trying to **ascertain** the cause of the phenomenon.", trans: "C√°c nh√† khoa h·ªçc ƒëang c·ªë g·∫Øng x√°c ƒë·ªãnh nguy√™n nh√¢n c·ªßa hi·ªán t∆∞·ª£ng n√†y." },
        { text: "The new law will **implement** stricter rules on waste disposal.", trans: "Lu·∫≠t m·ªõi s·∫Ω th·ª±c thi c√°c quy ƒë·ªãnh nghi√™m ng·∫∑t h∆°n v·ªÅ vi·ªác ƒë·ªï r√°c th·∫£i." },
        { text: "It is **inevitable** that technology will change the way we work.", trans: "Vi·ªác c√¥ng ngh·ªá thay ƒë·ªïi c√°ch ch√∫ng ta l√†m vi·ªác l√† ƒëi·ªÅu kh√¥ng th·ªÉ tr√°nh kh·ªèi." },
        { text: "The manager's **ambiguous** instructions led to many mistakes.", trans: "Nh·ªØng ch·ªâ d·∫´n m∆° h·ªì c·ªßa ng∆∞·ªùi qu·∫£n l√Ω ƒë√£ d·∫´n ƒë·∫øn nhi·ªÅu sai l·∫ßm." },
        { text: "Students are encouraged to **utilize** the library's online resources.", trans: "H·ªçc sinh ƒë∆∞·ª£c khuy·∫øn kh√≠ch t·∫≠n d·ª•ng c√°c ngu·ªìn t√†i nguy√™n tr·ª±c tuy·∫øn c·ªßa th∆∞ vi·ªán." },
        { text: "The company needs to **diversify** its products to reach more customers.", trans: "C√¥ng ty c·∫ßn ƒëa d·∫°ng h√≥a s·∫£n ph·∫©m ƒë·ªÉ ti·∫øp c·∫≠n nhi·ªÅu kh√°ch h√†ng h∆°n." },
        { text: "His **eloquent** speech moved many people in the audience.", trans: "B√†i ph√°t bi·ªÉu h√πng h·ªìn c·ªßa anh ·∫•y ƒë√£ l√†m lay ƒë·ªông nhi·ªÅu ng∆∞·ªùi trong kh√°n gi·∫£." },
        { text: "The government took measures to **alleviate** poverty in rural areas.", trans: "Ch√≠nh ph·ªß ƒë√£ th·ª±c hi·ªán c√°c bi·ªán ph√°p ƒë·ªÉ gi·∫£m b·ªõt ngh√®o ƒë√≥i ·ªü c√°c v√πng n√¥ng th√¥n." },
        { text: "The data shows a **significant** increase in online sales this year.", trans: "D·ªØ li·ªáu cho th·∫•y m·ªôt s·ª± gia tƒÉng ƒë√°ng k·ªÉ trong doanh s·ªë b√°n h√†ng tr·ª±c tuy·∫øn nƒÉm nay." },
        { text: "She has a **pragmatic** approach to solving complex problems.", trans: "C√¥ ·∫•y c√≥ m·ªôt c√°ch ti·∫øp c·∫≠n th·ª±c t·∫ø ƒë·ªÉ gi·∫£i quy·∫øt c√°c v·∫•n ƒë·ªÅ ph·ª©c t·∫°p." },
        { text: "We must **evaluate** the results before making a final decision.", trans: "Ch√∫ng ta ph·∫£i ƒë√°nh gi√° k·∫øt qu·∫£ tr∆∞·ªõc khi ƒë∆∞a ra quy·∫øt ƒë·ªãnh cu·ªëi c√πng." },
        { text: "The building's **infrastructure** was damaged during the storm.", trans: "C∆° s·ªü h·∫° t·∫ßng c·ªßa t√≤a nh√† ƒë√£ b·ªã h∆∞ h·∫°i trong c∆°n b√£o." },
        { text: "He is a **versatile** actor who can play both comedy and drama.", trans: "Anh ·∫•y l√† m·ªôt di·ªÖn vi√™n linh ho·∫°t, c√≥ th·ªÉ ƒë√≥ng c·∫£ h√†i k·ªãch v√† bi k·ªãch." },
        { text: "The CEO decided to **consolidate** the two departments to improve efficiency.", trans: "Gi√°m ƒë·ªëc ƒëi·ªÅu h√†nh quy·∫øt ƒë·ªãnh h·ª£p nh·∫•t hai b·ªô ph·∫≠n ƒë·ªÉ c·∫£i thi·ªán hi·ªáu qu·∫£." },
        { text: "Heavy rain might **jeopardize** our chances of finishing the construction.", trans: "M∆∞a l·ªõn c√≥ th·ªÉ g√¢y nguy hi·ªÉm cho c∆° h·ªôi ho√†n th√†nh c√¥ng tr√¨nh c·ªßa ch√∫ng ta." },
        { text: "The report offers a **comprehensive** analysis of the current market.", trans: "B·∫£n b√°o c√°o ƒë∆∞a ra m·ªôt ph√¢n t√≠ch to√†n di·ªán v·ªÅ th·ªã tr∆∞·ªùng hi·ªán t·∫°i." },
        { text: "The witness provided **contradictory** statements during the trial.", trans: "Nh√¢n ch·ª©ng ƒë√£ ƒë∆∞a ra nh·ªØng l·ªùi khai m√¢u thu·∫´n trong phi√™n t√≤a." },
        { text: "Digital transformation can **exacerbate** the gap between rich and poor.", trans: "Chuy·ªÉn ƒë·ªïi k·ªπ thu·∫≠t s·ªë c√≥ th·ªÉ l√†m tr·∫ßm tr·ªçng th√™m kho·∫£ng c√°ch gi√†u ngh√®o." },
        { text: "After hours of debate, the board finally reached a **consensus**.", trans: "Sau nhi·ªÅu gi·ªù tranh lu·∫≠n, h·ªôi ƒë·ªìng qu·∫£n tr·ªã cu·ªëi c√πng ƒë√£ ƒë·∫°t ƒë∆∞·ª£c s·ª± ƒë·ªìng thu·∫≠n." },
        { text: "High interest rates often **deter** people from taking out loans.", trans: "L√£i su·∫•t cao th∆∞·ªùng ngƒÉn c·∫£n m·ªçi ng∆∞·ªùi vay v·ªën." },
        { text: "The school aims to **foster** a sense of community among students.", trans: "Nh√† tr∆∞·ªùng nh·∫±m m·ª•c ƒë√≠ch nu√¥i d∆∞·ª°ng √Ω th·ª©c c·ªông ƒë·ªìng trong h·ªçc sinh." },
        { text: "The project was cancelled due to a **deficit** in the annual budget.", trans: "D·ª± √°n b·ªã h·ªßy b·ªè do th√¢m h·ª•t ng√¢n s√°ch h√†ng nƒÉm." },
        { text: "Her **unprecedented** success inspired many young entrepreneurs.", trans: "Th√†nh c√¥ng ch∆∞a t·ª´ng c√≥ c·ªßa c√¥ ƒë√£ truy·ªÅn c·∫£m h·ª©ng cho nhi·ªÅu doanh nh√¢n tr·∫ª." },
        { text: "The lawyer tried to **elucidate** the complex terms of the contract.", trans: "Lu·∫≠t s∆∞ c·ªë g·∫Øng gi·∫£i th√≠ch r√µ r√†ng c√°c ƒëi·ªÅu kho·∫£n ph·ª©c t·∫°p c·ªßa h·ª£p ƒë·ªìng." },
        { text: "There is no **tangible** evidence to support your accusations.", trans: "Kh√¥ng c√≥ b·∫±ng ch·ª©ng h·ªØu h√¨nh n√†o h·ªó tr·ª£ cho nh·ªØng l·ªùi c√°o bu·ªôc c·ªßa b·∫°n." },
        { text: "The local residents are **indigenous** to this mountainous region.", trans: "Nh·ªØng ng∆∞·ªùi d√¢n ƒë·ªãa ph∆∞∆°ng l√† ng∆∞·ªùi b·∫£n ƒë·ªãa c·ªßa v√πng n√∫i n√†y." },
        { text: "Artificial Intelligence is a **burgeoning** field with many job openings.", trans: "Tr√≠ tu·ªá nh√¢n t·∫°o l√† m·ªôt lƒ©nh v·ª±c ƒëang ph√°t tri·ªÉn nhanh ch√≥ng v·ªõi nhi·ªÅu c∆° h·ªôi vi·ªác l√†m." },
        { text: "The researchers found a **correlation** between stress and heart disease.", trans: "C√°c nh√† nghi√™n c·ª©u ƒë√£ t√¨m th·∫•y m·ªëi t∆∞∆°ng quan gi·ªØa cƒÉng th·∫≥ng v√† b·ªánh tim." },
        { text: "The government should **subsidize** public transport to reduce pollution.", trans: "Ch√≠nh ph·ªß n√™n tr·ª£ gi√° cho ph∆∞∆°ng ti·ªán c√¥ng c·ªông ƒë·ªÉ gi·∫£m √¥ nhi·ªÖm." },
        { text: "He is **oblivious** to the fact that everyone is laughing at him.", trans: "Anh ta kh√¥ng h·ªÅ hay bi·∫øt s·ª± th·∫≠t r·∫±ng m·ªçi ng∆∞·ªùi ƒëang c∆∞·ªùi nh·∫°o m√¨nh." },
        { text: "The medicine will **mitigate** the symptoms but won't cure the cold.", trans: "Thu·ªëc s·∫Ω l√†m gi·∫£m c√°c tri·ªáu ch·ª©ng nh∆∞ng kh√¥ng ch·ªØa kh·ªèi b·ªánh c·∫£m l·∫°nh." },
        { text: "The company's profits began to **fluctuate** wildly last quarter.", trans: "L·ª£i nhu·∫≠n c·ªßa c√¥ng ty b·∫Øt ƒë·∫ßu dao ƒë·ªông d·ªØ d·ªôi trong qu√Ω v·ª´a qua." },
        { text: "Working in a call center can be extremely **monotonous**.", trans: "L√†m vi·ªác t·∫°i trung t√¢m cu·ªôc g·ªçi c√≥ th·ªÉ v√¥ c√πng ƒë∆°n ƒëi·ªáu." },
        { text: "They need to **refurbish** the old office before moving back in.", trans: "H·ªç c·∫ßn t√¢n trang l·∫°i vƒÉn ph√≤ng c≈© tr∆∞·ªõc khi d·ªùi l·∫°i v√†o ƒë√≥." },
        { text: "The speaker's voice was barely **audible** over the noise of the crowd.", trans: "Gi·ªçng n√≥i c·ªßa ng∆∞·ªùi di·ªÖn thuy·∫øt h·∫ßu nh∆∞ kh√¥ng th·ªÉ nghe th·∫•y ƒë∆∞·ª£c v√¨ ti·∫øng ·ªìn c·ªßa ƒë√°m ƒë√¥ng." },
        { text: "Education is a **fundamental** right for every human being.", trans: "Gi√°o d·ª•c l√† quy·ªÅn c∆° b·∫£n c·ªßa m·ªói con ng∆∞·ªùi." },
        { text: "She was **apprehensive** about her first day in the new position.", trans: "C√¥ ·∫•y c·∫£m th·∫•y lo l·∫Øng v·ªÅ ng√†y ƒë·∫ßu ti√™n ·ªü v·ªã tr√≠ m·ªõi." },
        { text: "The teacher gave us **explicit** instructions on how to write the essay.", trans: "Gi√°o vi√™n ƒë√£ cho ch√∫ng t√¥i nh·ªØng ch·ªâ d·∫´n r√µ r√†ng v·ªÅ c√°ch vi·∫øt b√†i lu·∫≠n." },
        { text: "His theory is purely **hypothetical** and has not been tested yet.", trans: "L√Ω thuy·∫øt c·ªßa √¥ng ho√†n to√†n mang t√≠nh gi·∫£ thuy·∫øt v√† v·∫´n ch∆∞a ƒë∆∞·ª£c ki·ªÉm ch·ª©ng." },
        { text: "We need to **scrutinize** the documents for any potential errors.", trans: "Ch√∫ng ta c·∫ßn ki·ªÉm tra k·ªπ l∆∞·ª°ng c√°c t√†i li·ªáu ƒë·ªÉ t√¨m ra b·∫•t k·ª≥ l·ªói ti·ªÅm ·∫©n n√†o." },
        { text: "A healthy diet is **beneficial** for your overall well-being.", trans: "Ch·∫ø ƒë·ªô ƒÉn u·ªëng l√†nh m·∫°nh c√≥ l·ª£i cho s·ª©c kh·ªèe t·ªïng th·ªÉ c·ªßa b·∫°n." },
        { text: "The instructions were so **convoluted** that nobody understood them.", trans: "C√°c h∆∞·ªõng d·∫´n qu√° r·∫Øc r·ªëi ƒë·∫øn n·ªói kh√¥ng ai hi·ªÉu ƒë∆∞·ª£c ch√∫ng." },
        { text: "She handled the difficult situation with great **discretion**.", trans: "C√¥ ·∫•y ƒë√£ x·ª≠ l√Ω t√¨nh hu·ªëng kh√≥ khƒÉn v·ªõi s·ª± th·∫≠n tr·ªçng tuy·ªát v·ªùi." },
        { text: "It is often **counterproductive** to work late into the night.", trans: "L√†m vi·ªác mu·ªôn v√†o ƒë√™m th∆∞·ªùng ph·∫£n t√°c d·ª•ng." },
        { text: "The judge's decision was **impartial** and based only on facts.", trans: "Quy·∫øt ƒë·ªãnh c·ªßa th·∫©m ph√°n l√† c√¥ng t√¢m v√† ch·ªâ d·ª±a tr√™n s·ª± th·∫≠t." },
        { text: "This software is **compatible** with most operating systems.", trans: "Ph·∫ßn m·ªÅm n√†y t∆∞∆°ng th√≠ch v·ªõi h·∫ßu h·∫øt c√°c h·ªá ƒëi·ªÅu h√†nh." },
        { text: "The smell of fresh bread is **pervasive** in the bakery.", trans: "M√πi b√°nh m√¨ t∆∞∆°i lan t·ªèa kh·∫Øp ti·ªám b√°nh." },
        { text: "Her **resilience** helped her overcome the tragedy and move on.", trans: "S·ª± ki√™n c∆∞·ªùng ƒë√£ gi√∫p c√¥ v∆∞·ª£t qua bi k·ªãch v√† ti·∫øp t·ª•c s·ªëng." },
        { text: "The country enjoys a period of great **prosperity** thanks to trade.", trans: "ƒê·∫•t n∆∞·ªõc t·∫≠n h∆∞·ªüng m·ªôt th·ªùi k·ª≥ th·ªãnh v∆∞·ª£ng l·ªõn nh·ªù v√†o th∆∞∆°ng m·∫°i." },
        { text: "You must **adhere** to the safety regulations at all times.", trans: "B·∫°n ph·∫£i tu√¢n th·ªß c√°c quy ƒë·ªãnh an to√†n v√†o m·ªçi l√∫c." },
        { text: "The internet has become **ubiquitous** in modern society.", trans: "Internet ƒë√£ tr·ªü n√™n ph·ªï bi·∫øn kh·∫Øp m·ªçi n∆°i trong x√£ h·ªôi hi·ªán ƒë·∫°i." },
        { text: "His contribution to the project was **invaluable**.", trans: "S·ª± ƒë√≥ng g√≥p c·ªßa anh ·∫•y cho d·ª± √°n l√† v√¥ gi√°." },
        { text: "Environmentalists **advocate** for the protection of marine life.", trans: "C√°c nh√† m√¥i tr∆∞·ªùng h·ªçc ·ªßng h·ªô vi·ªác b·∫£o v·ªá sinh v·∫≠t bi·ªÉn." },
        { text: "The results of the experiment were **anomalous** and unexpected.", trans: "K·∫øt qu·∫£ c·ªßa cu·ªôc th√≠ nghi·ªám l√† b·∫•t th∆∞·ªùng v√† kh√¥ng mong ƒë·ª£i." },
        { text: "The selection process seemed completely **arbitrary** to the applicants.", trans: "Qu√° tr√¨nh l·ª±a ch·ªçn d∆∞·ªùng nh∆∞ ho√†n to√†n t√πy ti·ªán ƒë·ªëi v·ªõi c√°c ·ª©ng vi√™n." },
        { text: "Fluency in English is a major **asset** in today's job market.", trans: "Th√¥ng th·∫°o ti·∫øng Anh l√† m·ªôt t√†i s·∫£n l·ªõn trong th·ªã tr∆∞·ªùng vi·ªác l√†m ng√†y nay." },
        { text: "He is an **assiduous** worker who never misses a detail.", trans: "Anh ·∫•y l√† m·ªôt nh√¢n vi√™n si√™ng nƒÉng, ng∆∞·ªùi kh√¥ng bao gi·ªù b·ªè l·ª° m·ªôt chi ti·∫øt n√†o." },
        { text: "The company plans to **augment** its staff by hiring more experts.", trans: "C√¥ng ty c√≥ k·∫ø ho·∫°ch tƒÉng c∆∞·ªùng nh√¢n s·ª± b·∫±ng c√°ch thu√™ th√™m chuy√™n gia." },
        { text: "Local councils were given more **autonomy** to manage their budgets.", trans: "C√°c h·ªôi ƒë·ªìng ƒë·ªãa ph∆∞∆°ng ƒë√£ ƒë∆∞·ª£c trao quy·ªÅn t·ª± ch·ªß nhi·ªÅu h∆°n ƒë·ªÉ qu·∫£n l√Ω ng√¢n s√°ch." },
        { text: "The billionaire is known for his **benevolent** donations to charity.", trans: "V·ªã t·ª∑ ph√∫ n·ªïi ti·∫øng v·ªõi nh·ªØng kho·∫£n quy√™n g√≥p nh√¢n t·ª´ cho t·ª´ thi·ªán." },
        { text: "I was completely **bewildered** by the complex instructions.", trans: "T√¥i ho√†n to√†n b·ªã b·ªëi r·ªëi b·ªüi nh·ªØng ch·ªâ d·∫´n ph·ª©c t·∫°p." },
        { text: "To be **candid**, I don't think this plan will work.", trans: "N√≥i th·∫≥ng th·∫Øn th√¨ t√¥i kh√¥ng nghƒ© k·∫ø ho·∫°ch n√†y s·∫Ω hi·ªáu qu·∫£." },
        { text: "A **cohesive** team is essential for the success of any startup.", trans: "M·ªôt ƒë·ªôi ng≈© g·∫Øn k·∫øt l√† ƒëi·ªÅu c·∫ßn thi·∫øt cho s·ª± th√†nh c√¥ng c·ªßa b·∫•t k·ª≥ kh·ªüi nghi·ªáp n√†o." },
        { text: "We are **cognizant** of the difficulties involved in this task.", trans: "Ch√∫ng t√¥i nh·∫≠n th·ª©c r√µ nh·ªØng kh√≥ khƒÉn li√™n quan ƒë·∫øn nhi·ªám v·ª• n√†y." },
        { text: "Salary should be **commensurate** with experience and skills.", trans: "L∆∞∆°ng b·ªïng n√™n t∆∞∆°ng x·ª©ng v·ªõi kinh nghi·ªám v√† k·ªπ nƒÉng." },
        { text: "We cannot afford to become **complacent** about our achievements.", trans: "Ch√∫ng ta kh√¥ng ƒë∆∞·ª£c ph√©p tr·ªü n√™n t·ª± m√£n v·ªÅ nh·ªØng th√†nh t·ª±u c·ªßa m√¨nh." },
        { text: "Please keep your presentation **concise** and to the point.", trans: "Vui l√≤ng gi·ªØ cho b√†i thuy·∫øt tr√¨nh ng·∫Øn g·ªçn v√† ƒëi th·∫≥ng v√†o v·∫•n ƒë·ªÅ." },
        { text: "The school does not **condone** any form of bullying.", trans: "Nh√† tr∆∞·ªùng kh√¥ng bao dung cho b·∫•t k·ª≥ h√¨nh th·ª©c b·∫Øt n·∫°t n√†o." },
        { text: "The quiet atmosphere is **conducive** to studying.", trans: "B·∫ßu kh√¥ng kh√≠ y√™n tƒ©nh r·∫•t c√≥ l·ª£i cho vi·ªác h·ªçc t·∫≠p." },
        { text: "He is a **conscientious** student who always finishes his homework.", trans: "C·∫≠u ·∫•y l√† m·ªôt h·ªçc sinh t·∫≠n t√¢m, lu√¥n ho√†n th√†nh b√†i t·∫≠p v·ªÅ nh√†." },
        { text: "The red tower is a **conspicuous** landmark in the city.", trans: "T√≤a th√°p ƒë·ªè l√† m·ªôt c·ªôt m·ªëc d·ªÖ th·∫•y trong th√†nh ph·ªë." },
        { text: "Budget **constraints** prevented us from upgrading the equipment.", trans: "Nh·ªØng h·∫°n ch·∫ø v·ªÅ ng√¢n s√°ch ƒë√£ ngƒÉn c·∫£n ch√∫ng t√¥i n√¢ng c·∫•p thi·∫øt b·ªã." },
        { text: "She took a moment to **contemplate** her future career path.", trans: "C√¥ ·∫•y d√†nh m·ªôt ch√∫t th·ªùi gian ƒë·ªÉ suy ng·∫´m v·ªÅ con ƒë∆∞·ªùng s·ª± nghi·ªáp t∆∞∆°ng lai." },
        { text: "He preferred a **conventional** wedding over a modern one.", trans: "Anh ·∫•y th√≠ch m·ªôt ƒë√°m c∆∞·ªõi truy·ªÅn th·ªëng h∆°n l√† m·ªôt ƒë√°m c∆∞·ªõi hi·ªán ƒë·∫°i." },
        { text: "The staff always gave us a **cordial** welcome at the hotel.", trans: "Nh√¢n vi√™n lu√¥n d√†nh cho ch√∫ng t√¥i s·ª± ch√†o ƒë√≥n n·ªìng h·∫≠u t·∫°i kh√°ch s·∫°n." },
        { text: "Quality is the main **criterion** for selecting the winner.", trans: "Ch·∫•t l∆∞·ª£ng l√† ti√™u ch√≠ ch√≠nh ƒë·ªÉ l·ª±a ch·ªçn ng∆∞·ªùi chi·∫øn th·∫Øng." },
        { text: "The old filing system was **cumbersome** and slow.", trans: "H·ªá th·ªëng l∆∞u tr·ªØ c≈© r·∫•t c·ªìng k·ªÅnh v√† ch·∫≠m ch·∫°p." },
        { text: "The company had to **curtail** its spending due to the recession.", trans: "C√¥ng ty ƒë√£ ph·∫£i c·∫Øt gi·∫£m chi ti√™u do suy tho√°i kinh t·∫ø." },
        { text: "She felt **daunted** by the sheer amount of work ahead.", trans: "C√¥ c·∫£m th·∫•y n·∫£n l√≤ng tr∆∞·ªõc l∆∞·ª£ng c√¥ng vi·ªác kh·ªïng l·ªì ph√≠a tr∆∞·ªõc." },
        { text: "The patient suffered from a **debilitating** illness for years.", trans: "B·ªánh nh√¢n ƒë√£ ph·∫£i ch·ªãu ƒë·ª±ng m·ªôt cƒÉn b·ªánh l√†m suy nh∆∞·ª£c trong nhi·ªÅu nƒÉm." },
        { text: "It was difficult to **decipher** his messy handwriting.", trans: "R·∫•t kh√≥ ƒë·ªÉ gi·∫£i m√£ ch·ªØ vi·∫øt tay c·∫©u th·∫£ c·ªßa anh ta." },
        { text: "He showed great **deference** to his elders.", trans: "Anh ·∫•y th·ªÉ hi·ªán s·ª± t√¥n tr·ªçng l·ªõn ƒë·ªëi v·ªõi nh·ªØng ng∆∞·ªùi l·ªõn tu·ªïi." },
        { text: "Vitamin **deficiency** can lead to various health problems.", trans: "Thi·∫øu h·ª•t vitamin c√≥ th·ªÉ d·∫´n ƒë·∫øn nhi·ªÅu v·∫•n ƒë·ªÅ s·ª©c kh·ªèe kh√°c nhau." },
        { text: "Smoking has a **deleterious** effect on your lungs.", trans: "H√∫t thu·ªëc c√≥ t√°c ƒë·ªông c√≥ h·∫°i l√™n ph·ªïi c·ªßa b·∫°n." },
        { text: "Her professional **demeanor** impressed the hiring manager.", trans: "Th√°i ƒë·ªô chuy√™n nghi·ªáp c·ªßa c√¥ ·∫•y ƒë√£ g√¢y ·∫•n t∆∞·ª£ng v·ªõi qu·∫£n l√Ω tuy·ªÉn d·ª•ng." },
        { text: "The community rose up to **denounce** the violent attacks.", trans: "C·ªông ƒë·ªìng ƒë√£ ƒë·ª©ng l√™n ƒë·ªÉ l√™n √°n c√°c cu·ªôc t·∫•n c√¥ng b·∫°o l·ª±c." },
        { text: "If we continue to **deplete** natural resources, we will face a crisis.", trans: "N·∫øu ch√∫ng ta ti·∫øp t·ª•c l√†m c·∫°n ki·ªát t√†i nguy√™n thi√™n nhi√™n, ch√∫ng ta s·∫Ω ƒë·ªëi m·∫∑t v·ªõi kh·ªßng ho·∫£ng." },
        { text: "Critics often **deride** his films for being too predictable.", trans: "C√°c nh√† ph√™ b√¨nh th∆∞·ªùng ch·∫ø nh·∫°o c√°c b·ªô phim c·ªßa √¥ng v√¨ qu√° d·ªÖ ƒëo√°n." },
        { text: "She grew **despondent** after failing the exam for the third time.", trans: "C√¥ ·∫•y tr·ªü n√™n tuy·ªát v·ªçng sau khi tr∆∞·ª£t k·ª≥ thi l·∫ßn th·ª© ba." },
        { text: "Excessive sugar consumption is **detrimental** to your teeth.", trans: "Ti√™u th·ª• qu√° nhi·ªÅu ƒë∆∞·ªùng c√≥ h·∫°i cho rƒÉng c·ªßa b·∫°n." },
        { text: "Do not **deviate** from the path, or you might get lost.", trans: "ƒê·ª´ng ƒëi ch·ªách kh·ªèi con ƒë∆∞·ªùng, n·∫øu kh√¥ng b·∫°n c√≥ th·ªÉ b·ªã l·∫°c." },
        { text: "He is a **diligent** student who studies late every night.", trans: "C·∫≠u ·∫•y l√† m·ªôt h·ªçc sinh c·∫ßn c√π, h·ªçc b√†i mu·ªôn m·ªói ƒë√™m." },
        { text: "The pain will **diminish** after you take the medicine.", trans: "C∆°n ƒëau s·∫Ω gi·∫£m b·ªõt sau khi b·∫°n u·ªëng thu·ªëc." },
        { text: "There is a large **discrepancy** between the two reports.", trans: "C√≥ m·ªôt s·ª± kh√°c bi·ªát l·ªõn gi·ªØa hai b·∫£n b√°o c√°o." },
        { text: "The doctor was very **discreet** about the patient's condition.", trans: "B√°c sƒ© r·∫•t k√≠n ƒë√°o v·ªÅ t√¨nh tr·∫°ng c·ªßa b·ªánh nh√¢n." },
        { text: "He looked at the cheap imitation with **disdain**.", trans: "Anh ·∫•y nh√¨n m√≥n ƒë·ªì gi·∫£ r·∫ª ti·ªÅn v·ªõi s·ª± khinh mi·ªát." },
        { text: "The mechanic had to **dismantle** the engine to find the fault.", trans: "Th·ª£ m√°y ƒë√£ ph·∫£i th√°o d·ª° ƒë·ªông c∆° ƒë·ªÉ t√¨m ra l·ªói." },
        { text: "The goal of the seminar is to **disseminate** new research findings.", trans: "M·ª•c ti√™u c·ªßa cu·ªôc h·ªôi th·∫£o l√† ph·ªï bi·∫øn c√°c k·∫øt qu·∫£ nghi√™n c·ª©u m·ªõi." },
        { text: "The two friends took **divergent** paths after graduating.", trans: "Hai ng∆∞·ªùi b·∫°n ƒë√£ ƒëi theo nh·ªØng con ƒë∆∞·ªùng kh√°c nhau sau khi t·ªët nghi·ªáp." }
    ]; 
    // ============================================================

    let currentQuestions = [];

    // X·ª≠ l√Ω file Word
    document.getElementById('file-upload').addEventListener('change', function(e) {
        const reader = new FileReader();
        reader.onload = function(event) {
            mammoth.convertToHtml({arrayBuffer: event.target.result})
                .then(result => { document.getElementById('input-area').innerHTML = result.value; });
        };
        reader.readAsArrayBuffer(this.files[0]);
    });

    function startExercise() {
        const inputDiv = document.getElementById('input-area');
        let extracted = [];
        const nodes = inputDiv.querySelectorAll('b, strong, u, span[style*="underline"]');
        
        nodes.forEach(node => {
            let word = node.innerText.trim();
            let fullSentence = node.parentElement.innerText;
            if(word.length > 1) extracted.push({ answer: word, text: fullSentence, trans: "Custom Upload" });
        });

        let pool = [...extracted];
        if(pool.length < 1 && FALLBACK_DATA.length > 0) {
            const extra = FALLBACK_DATA.sort(() => 0.5 - Math.random());
            extra.forEach(item => {
                if(item.text.includes('**')) {
                    const match = item.text.match(/\*\*(.*?)\*\*/);
                    if(match) {
                        pool.push({ answer: match[1], text: item.text.replace(/\*\*/g, ''), trans: item.trans });
                    }
                }
            });
        }

        currentQuestions = pool.sort(() => 0.5 - Math.random()).slice(0, 15);
        if(currentQuestions.length === 0) { alert("Thi·∫øu d·ªØ li·ªáu!"); return; }

        renderUI();
    }

    function renderUI() {
        const list = document.getElementById('questions-list');
        const bank = document.getElementById('bank-content');
        list.innerHTML = ''; bank.innerHTML = '';

        currentQuestions.forEach((q, idx) => {
            const div = document.createElement('div');
            div.className = 'sentence-card';
            const blankHtml = `<span class="drop-zone" data-id="${idx}" onclick="clearZone(this)"></span>`;
            const regex = new RegExp(`\\b${escapeRegExp(q.answer)}\\b`, 'gi');
            div.innerHTML = `<div class="q-number">${idx + 1}</div><div style="width:100%">${q.text.replace(regex, blankHtml)}</div>`;
            list.appendChild(div);
        });

        const allWords = currentQuestions.map(q => q.answer).sort(() => Math.random() - 0.5);
        allWords.forEach((word) => {
            const span = document.createElement('span');
            span.className = 'draggable-word';
            span.innerText = word;
            initMobileDrag(span); // K√≠ch ho·∫°t k√©o th·∫£ x·ªãn
            bank.appendChild(span);
        });

        document.getElementById('setup-card').classList.add('hidden');
        document.getElementById('exercise-view').classList.remove('hidden');
        window.scrollTo(0,0);
    }

    function clearZone(zone) {
        if(zone.innerText !== "") {
            toggleBankWord(zone.innerText, false);
            zone.innerText = "";
        }
    }

    // --- C∆† CH·∫æ K√âO TH·∫¢ NHANH (TOUCH EVENT) ---
    let activeClone = null;
    let activeSource = null;
    let touchOffsetX = 0;
    let touchOffsetY = 0;

    function initMobileDrag(el) {
        el.addEventListener('touchstart', handleDragStart, {passive: false});
        el.addEventListener('mousedown', handleDragStart);
    }

    function handleDragStart(e) {
        if (e.target.classList.contains('used')) return;
        e.preventDefault(); 
        
        let clientX, clientY;
        if (e.type === 'touchstart') {
            clientX = e.touches[0].clientX;
            clientY = e.touches[0].clientY;
        } else {
            clientX = e.clientX;
            clientY = e.clientY;
        }

        activeSource = e.target;
        activeClone = activeSource.cloneNode(true);
        activeClone.classList.add('dragging-clone');
        
        const rect = activeSource.getBoundingClientRect();
        touchOffsetX = clientX - rect.left;
        touchOffsetY = clientY - rect.top;

        activeClone.style.left = (clientX - touchOffsetX) + 'px';
        activeClone.style.top = (clientY - touchOffsetY) + 'px';
        activeClone.style.width = rect.width + 'px';
        
        document.body.appendChild(activeClone);

        if (e.type === 'touchstart') {
            document.addEventListener('touchmove', handleDragMove, {passive: false});
            document.addEventListener('touchend', handleDragEnd);
        } else {
            document.addEventListener('mousemove', handleDragMove);
            document.addEventListener('mouseup', handleDragEnd);
        }
    }

    function handleDragMove(e) {
        if (!activeClone) return;
        e.preventDefault();
        let clientX, clientY;
        if (e.type === 'touchmove') {
            clientX = e.touches[0].clientX;
            clientY = e.touches[0].clientY;
        } else {
            clientX = e.clientX;
            clientY = e.clientY;
        }
        activeClone.style.left = (clientX - activeClone.offsetWidth / 2) + 'px';
        activeClone.style.top = (clientY - activeClone.offsetHeight / 2) + 'px';
    }

    function handleDragEnd(e) {
        if (!activeClone) return;
        let clientX, clientY;
        if (e.type === 'touchend') {
            clientX = e.changedTouches[0].clientX;
            clientY = e.changedTouches[0].clientY;
        } else {
            clientX = e.clientX;
            clientY = e.clientY;
        }

        activeClone.style.display = 'none';
        let elementBelow = document.elementFromPoint(clientX, clientY);
        activeClone.style.display = 'block';

        let dropZone = elementBelow ? elementBelow.closest('.drop-zone') : null;

        if (dropZone) {
            if (dropZone.innerText !== "") toggleBankWord(dropZone.innerText, false);
            dropZone.innerText = activeSource.innerText;
            toggleBankWord(activeSource.innerText, true);
        }

        activeClone.remove();
        activeClone = null;
        activeSource = null;
        document.removeEventListener('touchmove', handleDragMove);
        document.removeEventListener('touchend', handleDragEnd);
        document.removeEventListener('mousemove', handleDragMove);
        document.removeEventListener('mouseup', handleDragEnd);
    }

    function toggleBankWord(wordText, isUsed) {
        const bankWords = document.querySelectorAll('.draggable-word');
        for(let bw of bankWords) {
            if(bw.innerText === wordText && bw.classList.contains('used') === !isUsed) {
                isUsed ? bw.classList.add('used') : bw.classList.remove('used');
                break;
            }
        }
    }

    function escapeRegExp(string) { return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); }

    // --- N·ªòP B√ÄI ---
    document.getElementById('submit-btn').onclick = function() {
        let score = 0;
        const resultContainer = document.getElementById('detailed-results');
        resultContainer.innerHTML = '';

        currentQuestions.forEach((q, idx) => {
            const zone = document.querySelector(`.drop-zone[data-id="${idx}"]`);
            const userAns = zone ? zone.innerText.trim() : "";
            const isCorrect = userAns.toLowerCase() === q.answer.toLowerCase();
            if(isCorrect) score++;

            const div = document.createElement('div');
            div.className = 'sentence-card';
            div.innerHTML = `
                <div class="q-number">${idx + 1}</div>
                <div style="width:100%">
                    <p style="margin:0">
                        ${isCorrect ? '‚úÖ' : '‚ùå'} 
                        ${q.text.replace(new RegExp(`\\b${escapeRegExp(q.answer)}\\b`, 'gi'), `<span class="correct-ans">${q.answer}</span>`)}
                    </p>
                    <div class="feedback-box">
                        <span>B·∫°n ch·ªçn: <span class="${isCorrect ? 'correct-ans' : 'wrong-ans'}">${userAns || "(Tr·ªëng)"}</span></span>
                        <small class="viet-sub">${q.trans}</small>
                    </div>
                </div>
            `;
            resultContainer.appendChild(div);
        });

        document.getElementById('score-text').innerText = `K·∫æT QU·∫¢: ${score}/15`;
        document.getElementById('exercise-view').classList.add('hidden');
        document.getElementById('result-view').classList.remove('hidden');
        window.scrollTo(0,0);
    };
</script>

</body>
</html>
